meta {
  name: Test Complete OAuth Flow
  type: http
  seq: 10
}

get {
  url: {{baseUrl}}/auth/google
  body: none
  auth: none
}

headers {
  Accept: application/json
}

vars:pre-request {
  baseUrl: http://localhost:3000
}

script:pre-request {
  // Log the start of OAuth flow test
  console.log("üöÄ Starting OAuth Flow Test");
  console.log("Base URL:", bru.getVar("baseUrl"));
  console.log("Timestamp:", new Date().toISOString());
}

script:post-response {
  // Log response details
  const status = bru.getResponseStatus();
  const headers = bru.getResponseHeaders();
  
  console.log("üìä OAuth Flow Test Results:");
  console.log("Status:", status);
  console.log("Headers:", JSON.stringify(headers, null, 2));
  
  if (status === 302) {
    const location = headers.location;
    console.log("‚úÖ OAuth redirect successful!");
    console.log("Redirect URL:", location);
    
    if (location && location.includes("accounts.google.com")) {
      console.log("üéØ Redirecting to Google OAuth - Flow is working correctly!");
    } else {
      console.log("‚ö†Ô∏è  Unexpected redirect URL");
    }
  } else {
    console.log("‚ùå OAuth flow failed - expected 302 redirect");
  }
  
  // Store results for next request
  bru.setVar("oauthTestStatus", status);
  bru.setVar("oauthRedirectUrl", headers.location);
}

docs {
  # Test Complete OAuth Flow
  
  This endpoint tests the complete OAuth2 flow by initiating a Google login.
  
  ## What it tests:
  1. ‚úÖ OAuth endpoint is accessible
  2. ‚úÖ Proper redirect to Google OAuth
  3. ‚úÖ Correct HTTP status codes
  4. ‚úÖ Valid redirect headers
  
  ## Expected Results:
  - **Status**: 302 (Redirect)
  - **Location Header**: Contains Google OAuth URL
  - **Console Logs**: Detailed flow information
  
  ## How to use:
  1. Run this endpoint
  2. Check console logs for detailed results
  3. Follow the redirect URL to complete OAuth flow
  4. Use the returned tokens in other endpoints
  
  ## Troubleshooting:
  - If status is not 302, check environment variables
  - If no redirect URL, verify OAuth configuration
  - Check console logs for detailed error information
}
